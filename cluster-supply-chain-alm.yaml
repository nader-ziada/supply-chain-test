

#@ load("@ytt:data", "data")
---
apiVersion: carto.run/v1alpha1
kind: ClusterSupplyChain
metadata:
  name: supply-chain-alm
spec:
  selectorMatchExpressions:
    - key: 'apps.tanzu.vmware.com/workload-type'
      operator: In
      values:
      - alm
  params:
  - name: maven_repository_url
    value: https://repo.maven.apache.org/maven2
  - default: main
    name: gitops_branch
  - default: supplychain
    name: gitops_user_name
  - default: supplychain
    name: gitops_user_email
  - default: supplychain@cluster.local
    name: gitops_commit_message
  - default: git-secret
    name: gitops_ssh_secret
  - default: https://github.com/
    name: gitops_server_address
  - default: nader-ziada
    name: gitops_repository_owner
  - default: gitops-test
    name: gitops_repository_name
  - default: github
    name: gitops_server_kind
  - default: ""
    name: gitops_commit_branch
  - default: ready for review
    name: gitops_pull_request_title
  - default: generated by supply chain
    name: gitops_pull_request_body
  resources:
  - name: source-provider
    params:
    - name: serviceAccount
      value: default
    - name: gitImplementation
      value: go-git
    templateRef:
      kind: ClusterSourceTemplate
      name: source-template
  - name: image-provider
    params:
    - name: serviceAccount
      value: default
    - name: registry
      value:
        ca_cert_data: ""
        repository: nziada-tkg-dev/tap-images/workloads
        server: gcr.io
    - default: default
      name: clusterBuilder
    - default: ./Dockerfile
      name: dockerfile
    - default: ./
      name: docker_build_context
    - default: []
      name: docker_build_extra_args
    sources:
    - resource: source-provider
      name: source
    templateRef:
      kind: ClusterImageTemplate
      options:
      - name: kpack-template
        selector:
          matchFields:
            - key: spec.params[?(@.name=="dockerfile")]
              operator: DoesNotExist
      - name: kaniko-template
        selector:
          matchFields:
            - key: spec.params[?(@.name=="dockerfile")]
              operator: Exists

  - name: config-provider-alm
    images:
    - resource: image-provider
      name: image
    params:
    - name: serviceAccount
      value: default
    - name: registry
      value:
        ca_cert_data: ""
        repository: nziada-tkg-dev/tap-images/workloads
        server: gcr.io
    templateRef:
      kind: ClusterConfigTemplate
      name: carvelpkg-config

  - name: config-writer
    templateRef:
      kind: ClusterTemplate
      name: config-writer-and-pull-requester-template
    params:
      - name: serviceAccount
        default: default
      - name: registry
        value:
          ca_cert_data: ""
          repository: nziada-tkg-dev/tap-images/workloads
          server: gcr.io
    configs:
      - resource: config-provider-alm
        name: config



  selectorMatchExpressions:
  - key: apps.tanzu.vmware.com/workload-type
    operator: In
    values:
    - web
    - server
    - worker
    - alm